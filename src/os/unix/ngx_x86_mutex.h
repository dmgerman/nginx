begin_unit|revision:1.0.0;language:C;cregit-version:0.0.1
begin_typedef
DECL|struct|__anon295b1b170108
typedef|typedef
struct|struct
block|{
DECL|member|lock
name|int
name|lock
decl_stmt|;
DECL|typedef|ngx_mutex_t
block|}
name|ngx_mutex_t
typedef|;
end_typedef

begin_function
DECL|function|ngx_spin_lock (ngx_mutex_t * m,int count)
specifier|static
specifier|inline
name|int
name|ngx_spin_lock
parameter_list|(
name|ngx_mutex_t
modifier|*
name|m
parameter_list|,
name|int
name|count
parameter_list|)
block|{
name|int
name|lock
decl_stmt|;
name|__asm__
name|__volatile
argument_list|(
literal|"  get_lock:         mov   $1, %1         xchg  %1, %2         cmp   $0, %1         jne   spin_lock  spin_lock:         cmp   $0, %3         je    failed          dec   %3         rep   nop         cmp   $0, %2         jne   spin_lock      "
operator|:
literal|"=q"
operator|(
name|lock
operator|)
argument_list|,
literal|"m"
operator|(
name|m
operator|->
name|lock
operator|)
argument_list|,
literal|"q"
operator|(
name|count
operator|)
argument_list|)
decl_stmt|;
block|}
end_function

end_unit


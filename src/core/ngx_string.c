begin_unit|revision:1.0.0;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (C) Igor Sysoev  */
end_comment

begin_include
include|#
directive|include
file|<ngx_config.h>
end_include

begin_include
include|#
directive|include
file|<ngx_core.h>
end_include

begin_function
name|u_char
modifier|*
DECL|function|ngx_cpystrn (u_char * dst,u_char * src,size_t n)
name|ngx_cpystrn
parameter_list|(
name|u_char
modifier|*
name|dst
parameter_list|,
name|u_char
modifier|*
name|src
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|dst
return|;
block|}
for|for
control|(
comment|/* void */
init|;
operator|--
name|n
condition|;
name|dst
operator|++
operator|,
name|src
operator|++
control|)
block|{
operator|*
name|dst
operator|=
operator|*
name|src
expr_stmt|;
if|if
condition|(
operator|*
name|dst
operator|==
literal|'\0'
condition|)
block|{
return|return
name|dst
return|;
block|}
block|}
operator|*
name|dst
operator|=
literal|'\0'
expr_stmt|;
return|return
name|dst
return|;
block|}
end_function

begin_function
name|u_char
modifier|*
DECL|function|ngx_pstrdup (ngx_pool_t * pool,ngx_str_t * src)
name|ngx_pstrdup
parameter_list|(
name|ngx_pool_t
modifier|*
name|pool
parameter_list|,
name|ngx_str_t
modifier|*
name|src
parameter_list|)
block|{
name|u_char
modifier|*
name|dst
decl_stmt|;
name|dst
operator|=
name|ngx_palloc
argument_list|(
name|pool
argument_list|,
name|src
operator|->
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|==
name|NULL
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ngx_memcpy
argument_list|(
name|dst
argument_list|,
name|src
operator|->
name|data
argument_list|,
name|src
operator|->
name|len
argument_list|)
expr_stmt|;
return|return
name|dst
return|;
block|}
end_function

begin_comment
comment|/*  * supported formats:  *    %[0][width][x][X]O        off_t  *    %[0][width]T              time_t  *    %[0][width][u][x|X]z      ssize_t/size_t  *    %[0][width][u][x|X]d      int/u_int  *    %[0][width][u][x|X]l      long  *    %[0][width|m][u][x|X]i    ngx_int_t/ngx_uint_t  *    %[0][width][u][x|X]D      int32_t/uint32_t  *    %[0][width][u][x|X]L      int64_t/uint64_t  *    %[0][width|m][u][x|X]A    ngx_atomic_int_t/ngx_atomic_uint_t  *    %P                        ngx_pid_t  *    %M                        ngx_msec_t  *    %r                        rlim_t  *    %p                        pointer  *    %V                        pointer to ngx_str_t  *    %s                        null-terminated string  *    %Z                        '\0'  *    %N                        '\n'  *    %c                        char  *    %%                        %  *  *  reserved:  *    %t                        ptrdiff_t  *    %S                        null-teminated wchar string  *    %C                        wchar  */
end_comment

begin_function
name|u_char
modifier|*
name|ngx_cdecl
DECL|function|ngx_sprintf (u_char * buf,const char * fmt,...)
name|ngx_sprintf
parameter_list|(
name|u_char
modifier|*
name|buf
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|u_char
modifier|*
name|p
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|p
operator|=
name|ngx_vsnprintf
argument_list|(
name|buf
argument_list|,
comment|/* STUB */
literal|65536
argument_list|,
name|fmt
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|p
return|;
block|}
end_function

begin_function
name|u_char
modifier|*
name|ngx_cdecl
DECL|function|ngx_snprintf (u_char * buf,size_t max,const char * fmt,...)
name|ngx_snprintf
parameter_list|(
name|u_char
modifier|*
name|buf
parameter_list|,
name|size_t
name|max
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|u_char
modifier|*
name|p
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|p
operator|=
name|ngx_vsnprintf
argument_list|(
name|buf
argument_list|,
name|max
argument_list|,
name|fmt
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|p
return|;
block|}
end_function

begin_function
name|u_char
modifier|*
DECL|function|ngx_vsnprintf (u_char * buf,size_t max,const char * fmt,va_list args)
name|ngx_vsnprintf
parameter_list|(
name|u_char
modifier|*
name|buf
parameter_list|,
name|size_t
name|max
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
name|va_list
name|args
parameter_list|)
block|{
name|u_char
modifier|*
name|p
decl_stmt|,
name|zero
decl_stmt|,
modifier|*
name|last
decl_stmt|,
name|temp
index|[
name|NGX_INT64_LEN
operator|+
literal|1
index|]
decl_stmt|;
comment|/*                                      * really we need temp[NGX_INT64_LEN] only,                                      * but icc issues the warning                                      */
name|int
name|d
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|uint32_t
name|ui32
decl_stmt|;
name|int64_t
name|i64
decl_stmt|;
name|uint64_t
name|ui64
decl_stmt|;
name|ngx_msec_t
name|ms
decl_stmt|;
name|ngx_str_t
modifier|*
name|s
decl_stmt|;
name|ngx_uint_t
name|width
decl_stmt|,
name|sign
decl_stmt|,
name|hexadecimal
decl_stmt|,
name|max_width
decl_stmt|;
specifier|static
name|u_char
name|hex
index|[]
init|=
literal|"0123456789abcdef"
decl_stmt|;
specifier|static
name|u_char
name|HEX
index|[]
init|=
literal|"0123456789ABCDEF"
decl_stmt|;
if|if
condition|(
name|max
operator|==
literal|0
condition|)
block|{
return|return
name|buf
return|;
block|}
name|last
operator|=
name|buf
operator|+
name|max
expr_stmt|;
while|while
condition|(
operator|*
name|fmt
operator|&&
name|buf
operator|<
name|last
condition|)
block|{
comment|/*          * "buf< last" means that we could copy at least one character:          * the plain character, "%%", "%c", and minus without the checking          */
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'%'
condition|)
block|{
name|i64
operator|=
literal|0
expr_stmt|;
name|ui64
operator|=
literal|0
expr_stmt|;
name|zero
operator|=
operator|(
name|u_char
operator|)
operator|(
operator|(
operator|*
operator|++
name|fmt
operator|==
literal|'0'
operator|)
condition|?
literal|'0'
else|:
literal|' '
operator|)
expr_stmt|;
name|width
operator|=
literal|0
expr_stmt|;
name|sign
operator|=
literal|1
expr_stmt|;
name|hexadecimal
operator|=
literal|0
expr_stmt|;
name|max_width
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|temp
operator|+
name|NGX_INT64_LEN
expr_stmt|;
while|while
condition|(
operator|*
name|fmt
operator|>=
literal|'0'
operator|&&
operator|*
name|fmt
operator|<=
literal|'9'
condition|)
block|{
name|width
operator|=
name|width
operator|*
literal|10
operator|+
operator|*
name|fmt
operator|++
operator|-
literal|'0'
expr_stmt|;
block|}
for|for
control|(
init|;
condition|;
control|)
block|{
switch|switch
condition|(
operator|*
name|fmt
condition|)
block|{
case|case
literal|'u'
case|:
name|sign
operator|=
literal|0
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'m'
case|:
name|max_width
operator|=
literal|1
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'X'
case|:
name|hexadecimal
operator|=
literal|2
expr_stmt|;
name|sign
operator|=
literal|0
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'x'
case|:
name|hexadecimal
operator|=
literal|1
expr_stmt|;
name|sign
operator|=
literal|0
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
default|default:
break|break;
block|}
break|break;
block|}
switch|switch
condition|(
operator|*
name|fmt
condition|)
block|{
case|case
literal|'V'
case|:
name|s
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_str_t
operator|*
argument_list|)
expr_stmt|;
name|len
operator|=
name|s
operator|->
name|len
operator|&
literal|0xffff
expr_stmt|;
name|len
operator|=
operator|(
name|buf
operator|+
name|len
operator|<
name|last
operator|)
condition|?
name|len
else|:
operator|(
name|size_t
operator|)
operator|(
name|last
operator|-
name|buf
operator|)
expr_stmt|;
name|buf
operator|=
name|ngx_cpymem
argument_list|(
name|buf
argument_list|,
name|s
operator|->
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'s'
case|:
name|p
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|u_char
operator|*
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|&&
name|buf
operator|<
name|last
condition|)
block|{
operator|*
name|buf
operator|++
operator|=
operator|*
name|p
operator|++
expr_stmt|;
block|}
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'O'
case|:
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|off_t
argument_list|)
expr_stmt|;
name|sign
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'P'
case|:
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_pid_t
argument_list|)
expr_stmt|;
name|sign
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'T'
case|:
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|time_t
argument_list|)
expr_stmt|;
name|sign
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'M'
case|:
name|ms
operator|=
operator|(
name|ngx_msec_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_msec_t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ngx_msec_int_t
operator|)
name|ms
operator|==
operator|-
literal|1
condition|)
block|{
name|sign
operator|=
literal|1
expr_stmt|;
name|i64
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|sign
operator|=
literal|0
expr_stmt|;
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|ms
expr_stmt|;
block|}
break|break;
case|case
literal|'z'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ssize_t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|size_t
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'i'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_int_t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_uint_t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|max_width
condition|)
block|{
name|width
operator|=
name|NGX_INT_T_LEN
expr_stmt|;
block|}
break|break;
case|case
literal|'d'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|u_int
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'l'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|long
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|u_long
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'D'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|int32_t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|uint32_t
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'L'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int64_t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|uint64_t
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'A'
case|:
if|if
condition|(
name|sign
condition|)
block|{
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_atomic_int_t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|ngx_atomic_uint_t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|max_width
condition|)
block|{
name|width
operator|=
name|NGX_ATOMIC_T_LEN
expr_stmt|;
block|}
break|break;
if|#
directive|if
operator|!
operator|(
name|NGX_WIN32
operator|)
case|case
literal|'r'
case|:
name|i64
operator|=
operator|(
name|int64_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|rlim_t
argument_list|)
expr_stmt|;
name|sign
operator|=
literal|1
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
literal|'p'
case|:
name|ui64
operator|=
operator|(
name|uintptr_t
operator|)
name|va_arg
argument_list|(
name|args
argument_list|,
name|void
operator|*
argument_list|)
expr_stmt|;
name|hexadecimal
operator|=
literal|2
expr_stmt|;
name|sign
operator|=
literal|0
expr_stmt|;
name|zero
operator|=
literal|'0'
expr_stmt|;
name|width
operator|=
literal|8
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|d
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|++
operator|=
operator|(
name|u_char
operator|)
operator|(
name|d
operator|&
literal|0xff
operator|)
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'Z'
case|:
operator|*
name|buf
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'N'
case|:
if|#
directive|if
operator|(
name|NGX_WIN32
operator|)
operator|*
name|buf
operator|++
operator|=
name|CR
expr_stmt|;
endif|#
directive|endif
operator|*
name|buf
operator|++
operator|=
name|LF
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'%'
case|:
operator|*
name|buf
operator|++
operator|=
literal|'%'
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
continue|continue;
default|default:
operator|*
name|buf
operator|++
operator|=
operator|*
name|fmt
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|sign
condition|)
block|{
if|if
condition|(
name|i64
operator|<
literal|0
condition|)
block|{
operator|*
name|buf
operator|++
operator|=
literal|'-'
expr_stmt|;
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
operator|-
name|i64
expr_stmt|;
block|}
else|else
block|{
name|ui64
operator|=
operator|(
name|uint64_t
operator|)
name|i64
expr_stmt|;
block|}
block|}
if|if
condition|(
name|hexadecimal
operator|==
literal|1
condition|)
block|{
do|do
block|{
comment|/* the "(uint32_t)" cast disables the BCC's warning */
operator|*
operator|--
name|p
operator|=
name|hex
index|[
operator|(
name|uint32_t
operator|)
operator|(
name|ui64
operator|&
literal|0xf
operator|)
index|]
expr_stmt|;
block|}
do|while
condition|(
name|ui64
operator|>>=
literal|4
condition|)
do|;
block|}
if|else if
condition|(
name|hexadecimal
operator|==
literal|2
condition|)
block|{
do|do
block|{
comment|/* the "(uint32_t)" cast disables the BCC's warning */
operator|*
operator|--
name|p
operator|=
name|HEX
index|[
operator|(
name|uint32_t
operator|)
operator|(
name|ui64
operator|&
literal|0xf
operator|)
index|]
expr_stmt|;
block|}
do|while
condition|(
name|ui64
operator|>>=
literal|4
condition|)
do|;
block|}
if|else if
condition|(
name|ui64
operator|<=
name|NGX_MAX_UINT32_VALUE
condition|)
block|{
comment|/*                  * To divide 64-bit number and to find the remainder                  * on the x86 platform gcc and icc call the libc functions                  * [u]divdi3() and [u]moddi3(), they call another function                  * in its turn.  On FreeBSD it is the qdivrem() function,                  * its source code is about 170 lines of the code.                  * The glibc counterpart is about 150 lines of the code.                  *                  * For 32-bit numbers and some divisors gcc and icc use                  * the inlined multiplication and shifts.  For example,                  * unsigned "i32 / 10" is compiled to                  *                  *     (i32 * 0xCCCCCCCD)>> 35                  */
name|ui32
operator|=
operator|(
name|uint32_t
operator|)
name|ui64
expr_stmt|;
do|do
block|{
operator|*
operator|--
name|p
operator|=
operator|(
name|u_char
operator|)
operator|(
name|ui32
operator|%
literal|10
operator|+
literal|'0'
operator|)
expr_stmt|;
block|}
do|while
condition|(
name|ui32
operator|/=
literal|10
condition|)
do|;
block|}
else|else
block|{
do|do
block|{
operator|*
operator|--
name|p
operator|=
operator|(
name|u_char
operator|)
operator|(
name|ui64
operator|%
literal|10
operator|+
literal|'0'
operator|)
expr_stmt|;
block|}
do|while
condition|(
name|ui64
operator|/=
literal|10
condition|)
do|;
block|}
name|len
operator|=
operator|(
name|temp
operator|+
name|NGX_INT64_LEN
operator|)
operator|-
name|p
expr_stmt|;
while|while
condition|(
name|len
operator|++
operator|<
name|width
operator|&&
name|buf
operator|<
name|last
condition|)
block|{
operator|*
name|buf
operator|++
operator|=
name|zero
expr_stmt|;
block|}
name|len
operator|=
operator|(
name|temp
operator|+
name|NGX_INT64_LEN
operator|)
operator|-
name|p
expr_stmt|;
if|if
condition|(
name|buf
operator|+
name|len
operator|>
name|last
condition|)
block|{
name|len
operator|=
name|last
operator|-
name|buf
expr_stmt|;
block|}
name|buf
operator|=
name|ngx_cpymem
argument_list|(
name|buf
argument_list|,
name|p
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|fmt
operator|++
expr_stmt|;
block|}
else|else
block|{
operator|*
name|buf
operator|++
operator|=
operator|*
name|fmt
operator|++
expr_stmt|;
block|}
block|}
return|return
name|buf
return|;
block|}
end_function

begin_function
name|ngx_int_t
DECL|function|ngx_rstrncmp (u_char * s1,u_char * s2,size_t n)
name|ngx_rstrncmp
parameter_list|(
name|u_char
modifier|*
name|s1
parameter_list|,
name|u_char
modifier|*
name|s2
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
literal|0
return|;
block|}
name|n
operator|--
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|s1
index|[
name|n
index|]
operator|!=
name|s2
index|[
name|n
index|]
condition|)
block|{
return|return
name|s1
index|[
name|n
index|]
operator|-
name|s2
index|[
name|n
index|]
return|;
block|}
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
literal|0
return|;
block|}
name|n
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|ngx_int_t
DECL|function|ngx_rstrncasecmp (u_char * s1,u_char * s2,size_t n)
name|ngx_rstrncasecmp
parameter_list|(
name|u_char
modifier|*
name|s1
parameter_list|,
name|u_char
modifier|*
name|s2
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|u_char
name|c1
decl_stmt|,
name|c2
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
literal|0
return|;
block|}
name|n
operator|--
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c1
operator|=
name|s1
index|[
name|n
index|]
expr_stmt|;
if|if
condition|(
name|c1
operator|>=
literal|'a'
operator|&&
name|c1
operator|<=
literal|'z'
condition|)
block|{
name|c1
operator|-=
literal|'a'
operator|-
literal|'A'
expr_stmt|;
block|}
name|c2
operator|=
name|s2
index|[
name|n
index|]
expr_stmt|;
if|if
condition|(
name|c2
operator|>=
literal|'a'
operator|&&
name|c2
operator|<=
literal|'z'
condition|)
block|{
name|c2
operator|-=
literal|'a'
operator|-
literal|'A'
expr_stmt|;
block|}
if|if
condition|(
name|c1
operator|!=
name|c2
condition|)
block|{
return|return
name|c1
operator|-
name|c2
return|;
block|}
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
literal|0
return|;
block|}
name|n
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|ngx_int_t
DECL|function|ngx_atoi (u_char * line,size_t n)
name|ngx_atoi
parameter_list|(
name|u_char
modifier|*
name|line
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|ngx_int_t
name|value
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
for|for
control|(
name|value
operator|=
literal|0
init|;
name|n
operator|--
condition|;
name|line
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|line
argument_list|<
literal|'0'
operator|||
operator|*
name|line
argument_list|>
literal|'9'
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
name|value
operator|=
name|value
operator|*
literal|10
operator|+
operator|(
operator|*
name|line
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|value
operator|<
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
else|else
block|{
return|return
name|value
return|;
block|}
block|}
end_function

begin_function
name|ssize_t
DECL|function|ngx_atosz (u_char * line,size_t n)
name|ngx_atosz
parameter_list|(
name|u_char
modifier|*
name|line
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|ssize_t
name|value
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
for|for
control|(
name|value
operator|=
literal|0
init|;
name|n
operator|--
condition|;
name|line
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|line
argument_list|<
literal|'0'
operator|||
operator|*
name|line
argument_list|>
literal|'9'
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
name|value
operator|=
name|value
operator|*
literal|10
operator|+
operator|(
operator|*
name|line
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|value
operator|<
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
else|else
block|{
return|return
name|value
return|;
block|}
block|}
end_function

begin_function
name|off_t
DECL|function|ngx_atoof (u_char * line,size_t n)
name|ngx_atoof
parameter_list|(
name|u_char
modifier|*
name|line
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|off_t
name|value
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
for|for
control|(
name|value
operator|=
literal|0
init|;
name|n
operator|--
condition|;
name|line
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|line
argument_list|<
literal|'0'
operator|||
operator|*
name|line
argument_list|>
literal|'9'
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
name|value
operator|=
name|value
operator|*
literal|10
operator|+
operator|(
operator|*
name|line
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|value
operator|<
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
else|else
block|{
return|return
name|value
return|;
block|}
block|}
end_function

begin_function
name|time_t
DECL|function|ngx_atotm (u_char * line,size_t n)
name|ngx_atotm
parameter_list|(
name|u_char
modifier|*
name|line
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|time_t
name|value
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
for|for
control|(
name|value
operator|=
literal|0
init|;
name|n
operator|--
condition|;
name|line
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|line
argument_list|<
literal|'0'
operator|||
operator|*
name|line
argument_list|>
literal|'9'
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
name|value
operator|=
name|value
operator|*
literal|10
operator|+
operator|(
operator|*
name|line
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|value
operator|<
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
else|else
block|{
return|return
name|value
return|;
block|}
block|}
end_function

begin_function
name|ngx_int_t
DECL|function|ngx_hextoi (u_char * line,size_t n)
name|ngx_hextoi
parameter_list|(
name|u_char
modifier|*
name|line
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|u_char
name|ch
decl_stmt|;
name|ngx_int_t
name|value
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
for|for
control|(
name|value
operator|=
literal|0
init|;
name|n
operator|--
condition|;
name|line
operator|++
control|)
block|{
name|ch
operator|=
operator|*
name|line
expr_stmt|;
if|if
condition|(
name|ch
operator|>=
literal|'0'
operator|&&
name|ch
operator|<=
literal|'9'
condition|)
block|{
name|value
operator|=
name|value
operator|*
literal|16
operator|+
operator|(
name|ch
operator|-
literal|'0'
operator|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|ch
operator|>=
literal|'A'
operator|&&
name|ch
operator|<=
literal|'F'
condition|)
block|{
name|value
operator|=
name|value
operator|*
literal|16
operator|+
operator|(
name|ch
operator|-
literal|'A'
operator|+
literal|10
operator|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|ch
operator|>=
literal|'a'
operator|&&
name|ch
operator|<=
literal|'f'
condition|)
block|{
name|value
operator|=
name|value
operator|*
literal|16
operator|+
operator|(
name|ch
operator|-
literal|'a'
operator|+
literal|10
operator|)
expr_stmt|;
continue|continue;
block|}
return|return
name|NGX_ERROR
return|;
block|}
if|if
condition|(
name|value
operator|<
literal|0
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
else|else
block|{
return|return
name|value
return|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|ngx_md5_text (u_char * text,u_char * md5)
name|ngx_md5_text
parameter_list|(
name|u_char
modifier|*
name|text
parameter_list|,
name|u_char
modifier|*
name|md5
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
specifier|static
name|u_char
name|hex
index|[]
init|=
literal|"0123456789abcdef"
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|text
operator|++
operator|=
name|hex
index|[
name|md5
index|[
name|i
index|]
operator|>>
literal|4
index|]
expr_stmt|;
operator|*
name|text
operator|++
operator|=
name|hex
index|[
name|md5
index|[
name|i
index|]
operator|&
literal|0xf
index|]
expr_stmt|;
block|}
operator|*
name|text
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|ngx_encode_base64 (ngx_str_t * dst,ngx_str_t * src)
name|ngx_encode_base64
parameter_list|(
name|ngx_str_t
modifier|*
name|dst
parameter_list|,
name|ngx_str_t
modifier|*
name|src
parameter_list|)
block|{
name|u_char
modifier|*
name|d
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|size_t
name|len
decl_stmt|;
specifier|static
name|u_char
name|basis64
index|[]
init|=
literal|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
decl_stmt|;
name|len
operator|=
name|src
operator|->
name|len
expr_stmt|;
name|s
operator|=
name|src
operator|->
name|data
expr_stmt|;
name|d
operator|=
name|dst
operator|->
name|data
expr_stmt|;
while|while
condition|(
name|len
operator|>
literal|2
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
name|s
index|[
literal|0
index|]
operator|>>
literal|2
operator|)
operator|&
literal|0x3f
index|]
expr_stmt|;
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
operator|(
name|s
index|[
literal|0
index|]
operator|&
literal|3
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
name|s
index|[
literal|1
index|]
operator|>>
literal|4
operator|)
index|]
expr_stmt|;
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
operator|(
name|s
index|[
literal|1
index|]
operator|&
literal|0x0f
operator|)
operator|<<
literal|2
operator|)
operator||
operator|(
name|s
index|[
literal|2
index|]
operator|>>
literal|6
operator|)
index|]
expr_stmt|;
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
name|s
index|[
literal|2
index|]
operator|&
literal|0x3f
index|]
expr_stmt|;
name|s
operator|+=
literal|3
expr_stmt|;
name|len
operator|-=
literal|3
expr_stmt|;
block|}
if|if
condition|(
name|len
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
name|s
index|[
literal|0
index|]
operator|>>
literal|2
operator|)
operator|&
literal|0x3f
index|]
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
name|s
index|[
literal|0
index|]
operator|&
literal|3
operator|)
operator|<<
literal|4
index|]
expr_stmt|;
operator|*
name|d
operator|++
operator|=
literal|'='
expr_stmt|;
block|}
else|else
block|{
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
operator|(
name|s
index|[
literal|0
index|]
operator|&
literal|3
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
name|s
index|[
literal|1
index|]
operator|>>
literal|4
operator|)
index|]
expr_stmt|;
operator|*
name|d
operator|++
operator|=
name|basis64
index|[
operator|(
name|s
index|[
literal|1
index|]
operator|&
literal|0x0f
operator|)
operator|<<
literal|2
index|]
expr_stmt|;
block|}
operator|*
name|d
operator|++
operator|=
literal|'='
expr_stmt|;
block|}
name|dst
operator|->
name|len
operator|=
name|d
operator|-
name|dst
operator|->
name|data
expr_stmt|;
block|}
end_function

begin_function
name|ngx_int_t
DECL|function|ngx_decode_base64 (ngx_str_t * dst,ngx_str_t * src)
name|ngx_decode_base64
parameter_list|(
name|ngx_str_t
modifier|*
name|dst
parameter_list|,
name|ngx_str_t
modifier|*
name|src
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
name|u_char
modifier|*
name|d
decl_stmt|,
modifier|*
name|s
decl_stmt|;
specifier|static
name|u_char
name|basis64
index|[]
init|=
block|{
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|62
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|63
block|,
literal|52
block|,
literal|53
block|,
literal|54
block|,
literal|55
block|,
literal|56
block|,
literal|57
block|,
literal|58
block|,
literal|59
block|,
literal|60
block|,
literal|61
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|0
block|,
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|7
block|,
literal|8
block|,
literal|9
block|,
literal|10
block|,
literal|11
block|,
literal|12
block|,
literal|13
block|,
literal|14
block|,
literal|15
block|,
literal|16
block|,
literal|17
block|,
literal|18
block|,
literal|19
block|,
literal|20
block|,
literal|21
block|,
literal|22
block|,
literal|23
block|,
literal|24
block|,
literal|25
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|26
block|,
literal|27
block|,
literal|28
block|,
literal|29
block|,
literal|30
block|,
literal|31
block|,
literal|32
block|,
literal|33
block|,
literal|34
block|,
literal|35
block|,
literal|36
block|,
literal|37
block|,
literal|38
block|,
literal|39
block|,
literal|40
block|,
literal|41
block|,
literal|42
block|,
literal|43
block|,
literal|44
block|,
literal|45
block|,
literal|46
block|,
literal|47
block|,
literal|48
block|,
literal|49
block|,
literal|50
block|,
literal|51
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|,
literal|77
block|}
decl_stmt|;
for|for
control|(
name|len
operator|=
literal|0
init|;
name|len
operator|<
name|src
operator|->
name|len
condition|;
name|len
operator|++
control|)
block|{
if|if
condition|(
name|src
operator|->
name|data
index|[
name|len
index|]
operator|==
literal|'='
condition|)
block|{
break|break;
block|}
if|if
condition|(
name|basis64
index|[
name|src
operator|->
name|data
index|[
name|len
index|]
index|]
operator|==
literal|77
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
block|}
if|if
condition|(
name|len
operator|%
literal|4
operator|==
literal|1
condition|)
block|{
return|return
name|NGX_ERROR
return|;
block|}
name|s
operator|=
name|src
operator|->
name|data
expr_stmt|;
name|d
operator|=
name|dst
operator|->
name|data
expr_stmt|;
while|while
condition|(
name|len
operator|>
literal|3
condition|)
block|{
operator|*
name|d
operator|++
operator|=
operator|(
name|u_char
operator|)
operator|(
name|basis64
index|[
name|s
index|[
literal|0
index|]
index|]
operator|<<
literal|2
operator||
name|basis64
index|[
name|s
index|[
literal|1
index|]
index|]
operator|>>
literal|4
operator|)
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|(
name|u_char
operator|)
operator|(
name|basis64
index|[
name|s
index|[
literal|1
index|]
index|]
operator|<<
literal|4
operator||
name|basis64
index|[
name|s
index|[
literal|2
index|]
index|]
operator|>>
literal|2
operator|)
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|(
name|u_char
operator|)
operator|(
name|basis64
index|[
name|s
index|[
literal|2
index|]
index|]
operator|<<
literal|6
operator||
name|basis64
index|[
name|s
index|[
literal|3
index|]
index|]
operator|)
expr_stmt|;
name|s
operator|+=
literal|4
expr_stmt|;
name|len
operator|-=
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|>
literal|1
condition|)
block|{
operator|*
name|d
operator|++
operator|=
operator|(
name|u_char
operator|)
operator|(
name|basis64
index|[
name|s
index|[
literal|0
index|]
index|]
operator|<<
literal|2
operator||
name|basis64
index|[
name|s
index|[
literal|1
index|]
index|]
operator|>>
literal|4
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|>
literal|2
condition|)
block|{
operator|*
name|d
operator|++
operator|=
operator|(
name|u_char
operator|)
operator|(
name|basis64
index|[
name|s
index|[
literal|1
index|]
index|]
operator|<<
literal|4
operator||
name|basis64
index|[
name|s
index|[
literal|2
index|]
index|]
operator|>>
literal|2
operator|)
expr_stmt|;
block|}
name|dst
operator|->
name|len
operator|=
name|d
operator|-
name|dst
operator|->
name|data
expr_stmt|;
return|return
name|NGX_OK
return|;
block|}
end_function

begin_function
name|size_t
DECL|function|ngx_utf_length (ngx_str_t * utf)
name|ngx_utf_length
parameter_list|(
name|ngx_str_t
modifier|*
name|utf
parameter_list|)
block|{
name|u_char
name|c
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|ngx_uint_t
name|i
decl_stmt|;
for|for
control|(
name|len
operator|=
literal|0
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|utf
operator|->
name|len
condition|;
name|len
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|c
operator|=
name|utf
operator|->
name|data
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|c
operator|<
literal|0x80
condition|)
block|{
continue|continue;
block|}
if|if
condition|(
name|c
operator|>=
literal|0xc0
condition|)
block|{
for|for
control|(
name|c
operator|<<=
literal|1
init|;
name|c
operator|&
literal|0x80
condition|;
name|c
operator|<<=
literal|1
control|)
block|{
name|i
operator|++
expr_stmt|;
block|}
continue|continue;
block|}
comment|/* invalid utf */
return|return
name|utf
operator|->
name|len
return|;
block|}
return|return
name|len
return|;
block|}
end_function

begin_function
name|u_char
modifier|*
DECL|function|ngx_utf_cpystrn (u_char * dst,u_char * src,size_t n)
name|ngx_utf_cpystrn
parameter_list|(
name|u_char
modifier|*
name|dst
parameter_list|,
name|u_char
modifier|*
name|src
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
name|u_char
name|c
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
block|{
return|return
name|dst
return|;
block|}
for|for
control|(
comment|/* void */
init|;
operator|--
name|n
condition|;
name|dst
operator|++
operator|,
name|src
operator|++
control|)
block|{
name|c
operator|=
operator|*
name|src
expr_stmt|;
operator|*
name|dst
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|c
operator|<
literal|0x80
condition|)
block|{
if|if
condition|(
operator|*
name|dst
operator|!=
literal|'\0'
condition|)
block|{
continue|continue;
block|}
return|return
name|dst
return|;
block|}
if|if
condition|(
name|c
operator|>=
literal|0xc0
condition|)
block|{
for|for
control|(
name|c
operator|<<=
literal|1
init|;
name|c
operator|&
literal|0x80
condition|;
name|c
operator|<<=
literal|1
control|)
block|{
operator|*
operator|++
name|dst
operator|=
operator|*
operator|++
name|src
expr_stmt|;
block|}
continue|continue;
block|}
comment|/* invalid utf */
block|}
operator|*
name|dst
operator|=
literal|'\0'
expr_stmt|;
return|return
name|dst
return|;
block|}
end_function

begin_function
name|uintptr_t
DECL|function|ngx_escape_uri (u_char * dst,u_char * src,size_t size,ngx_uint_t type)
name|ngx_escape_uri
parameter_list|(
name|u_char
modifier|*
name|dst
parameter_list|,
name|u_char
modifier|*
name|src
parameter_list|,
name|size_t
name|size
parameter_list|,
name|ngx_uint_t
name|type
parameter_list|)
block|{
name|ngx_uint_t
name|i
decl_stmt|,
name|n
decl_stmt|;
name|uint32_t
modifier|*
name|escape
decl_stmt|;
specifier|static
name|u_char
name|hex
index|[]
init|=
literal|"0123456789abcdef"
decl_stmt|;
comment|/* " ", "#", "%", "?", %00-%1F, %7F-%FF */
specifier|static
name|uint32_t
name|uri
index|[]
init|=
block|{
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
comment|/* ?>=< ;:98 7654 3210  /.-, +*)( '&%$ #"!  */
literal|0x80000029
block|,
comment|/* 1000 0000 0000 0000  0000 0000 0010 1001 */
comment|/* _^]\ [ZYX WVUT SRQP  ONML KJIH GFED CBA@ */
literal|0x00000000
block|,
comment|/* 0000 0000 0000 0000  0000 0000 0000 0000 */
comment|/*  ~}| {zyx wvut srqp  onml kjih gfed cba` */
literal|0x80000000
block|,
comment|/* 1000 0000 0000 0000  0000 0000 0000 0000 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
block|}
decl_stmt|;
comment|/* " ", "#", "%", "+", "?", %00-%1F, %7F-%FF */
specifier|static
name|uint32_t
name|args
index|[]
init|=
block|{
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
comment|/* ?>=< ;:98 7654 3210  /.-, +*)( '&%$ #"!  */
literal|0x80000829
block|,
comment|/* 1000 0000 0000 0000  0000 1000 0010 1001 */
comment|/* _^]\ [ZYX WVUT SRQP  ONML KJIH GFED CBA@ */
literal|0x00000000
block|,
comment|/* 0000 0000 0000 0000  0000 0000 0000 0000 */
comment|/*  ~}| {zyx wvut srqp  onml kjih gfed cba` */
literal|0x80000000
block|,
comment|/* 1000 0000 0000 0000  0000 0000 0000 0000 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
block|}
decl_stmt|;
comment|/* " ", """, "%", "'", %00-%1F, %7F-%FF */
specifier|static
name|uint32_t
name|html
index|[]
init|=
block|{
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
comment|/* ?>=< ;:98 7654 3210  /.-, +*)( '&%$ #"!  */
literal|0x800000ad
block|,
comment|/* 0000 0000 0000 0000  0000 0000 1010 1101 */
comment|/* _^]\ [ZYX WVUT SRQP  ONML KJIH GFED CBA@ */
literal|0x00000000
block|,
comment|/* 0000 0000 0000 0000  0000 0000 0000 0000 */
comment|/*  ~}| {zyx wvut srqp  onml kjih gfed cba` */
literal|0x80000000
block|,
comment|/* 1000 0000 0000 0000  0000 0000 0000 0000 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
block|,
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
literal|0xffffffff
comment|/* 1111 1111 1111 1111  1111 1111 1111 1111 */
block|}
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|NGX_ESCAPE_HTML
case|:
name|escape
operator|=
name|html
expr_stmt|;
break|break;
case|case
name|NGX_ESCAPE_ARGS
case|:
name|escape
operator|=
name|args
expr_stmt|;
break|break;
default|default:
name|escape
operator|=
name|uri
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|dst
operator|==
name|NULL
condition|)
block|{
comment|/* find the number of the characters to be escaped */
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|escape
index|[
operator|*
name|src
operator|>>
literal|5
index|]
operator|&
operator|(
literal|1
operator|<<
operator|(
operator|*
name|src
operator|&
literal|0x1f
operator|)
operator|)
condition|)
block|{
name|n
operator|++
expr_stmt|;
block|}
name|src
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|uintptr_t
operator|)
name|n
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|escape
index|[
operator|*
name|src
operator|>>
literal|5
index|]
operator|&
operator|(
literal|1
operator|<<
operator|(
operator|*
name|src
operator|&
literal|0x1f
operator|)
operator|)
condition|)
block|{
operator|*
name|dst
operator|++
operator|=
literal|'%'
expr_stmt|;
operator|*
name|dst
operator|++
operator|=
name|hex
index|[
operator|*
name|src
operator|>>
literal|4
index|]
expr_stmt|;
operator|*
name|dst
operator|++
operator|=
name|hex
index|[
operator|*
name|src
operator|&
literal|0xf
index|]
expr_stmt|;
name|src
operator|++
expr_stmt|;
block|}
else|else
block|{
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
block|}
return|return
operator|(
name|uintptr_t
operator|)
name|dst
return|;
block|}
end_function

begin_function
name|void
DECL|function|ngx_unescape_uri (u_char ** dst,u_char ** src,size_t size)
name|ngx_unescape_uri
parameter_list|(
name|u_char
modifier|*
modifier|*
name|dst
parameter_list|,
name|u_char
modifier|*
modifier|*
name|src
parameter_list|,
name|size_t
name|size
parameter_list|)
block|{
name|u_char
modifier|*
name|d
decl_stmt|,
modifier|*
name|s
decl_stmt|,
name|ch
decl_stmt|,
name|c
decl_stmt|,
name|decoded
decl_stmt|;
DECL|enum|__anon2afb78c70103
enum|enum
block|{
DECL|enumerator|sw_usual
name|sw_usual
init|=
literal|0
block|,
DECL|enumerator|sw_quoted
name|sw_quoted
block|,
DECL|enumerator|sw_quoted_second
name|sw_quoted_second
block|}
name|state
enum|;
name|d
operator|=
operator|*
name|dst
expr_stmt|;
name|s
operator|=
operator|*
name|src
expr_stmt|;
name|state
operator|=
literal|0
expr_stmt|;
name|decoded
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|size
operator|--
condition|)
block|{
name|ch
operator|=
operator|*
name|s
operator|++
expr_stmt|;
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|sw_usual
case|:
if|if
condition|(
name|ch
operator|==
literal|'?'
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|ch
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|ch
operator|==
literal|'%'
condition|)
block|{
name|state
operator|=
name|sw_quoted
expr_stmt|;
break|break;
block|}
operator|*
name|d
operator|++
operator|=
name|ch
expr_stmt|;
break|break;
case|case
name|sw_quoted
case|:
if|if
condition|(
name|ch
operator|>=
literal|'0'
operator|&&
name|ch
operator|<=
literal|'9'
condition|)
block|{
name|decoded
operator|=
operator|(
name|u_char
operator|)
operator|(
name|ch
operator|-
literal|'0'
operator|)
expr_stmt|;
name|state
operator|=
name|sw_quoted_second
expr_stmt|;
break|break;
block|}
name|c
operator|=
operator|(
name|u_char
operator|)
operator|(
name|ch
operator||
literal|0x20
operator|)
expr_stmt|;
if|if
condition|(
name|c
operator|>=
literal|'a'
operator|&&
name|c
operator|<=
literal|'f'
condition|)
block|{
name|decoded
operator|=
operator|(
name|u_char
operator|)
operator|(
name|c
operator|-
literal|'a'
operator|+
literal|10
operator|)
expr_stmt|;
name|state
operator|=
name|sw_quoted_second
expr_stmt|;
break|break;
block|}
comment|/* skip the invalid quoted character */
name|s
operator|++
expr_stmt|;
name|size
operator|--
expr_stmt|;
break|break;
case|case
name|sw_quoted_second
case|:
if|if
condition|(
name|ch
operator|>=
literal|'0'
operator|&&
name|ch
operator|<=
literal|'9'
condition|)
block|{
name|ch
operator|=
operator|(
name|u_char
operator|)
operator|(
operator|(
name|decoded
operator|<<
literal|4
operator|)
operator|+
name|ch
operator|-
literal|'0'
operator|)
expr_stmt|;
name|state
operator|=
name|sw_usual
expr_stmt|;
if|if
condition|(
name|ch
operator|>
literal|'%'
operator|&&
name|ch
operator|<
literal|0x7f
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|ch
expr_stmt|;
break|break;
block|}
operator|*
name|d
operator|++
operator|=
literal|'%'
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
operator|(
name|s
operator|-
literal|2
operator|)
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
operator|(
name|s
operator|-
literal|1
operator|)
expr_stmt|;
break|break;
block|}
name|c
operator|=
operator|(
name|u_char
operator|)
operator|(
name|ch
operator||
literal|0x20
operator|)
expr_stmt|;
if|if
condition|(
name|c
operator|>=
literal|'a'
operator|&&
name|c
operator|<=
literal|'f'
condition|)
block|{
name|ch
operator|=
operator|(
name|u_char
operator|)
operator|(
operator|(
name|decoded
operator|<<
literal|4
operator|)
operator|+
name|c
operator|-
literal|'a'
operator|+
literal|10
operator|)
expr_stmt|;
if|if
condition|(
name|ch
operator|==
literal|'?'
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|ch
expr_stmt|;
goto|goto
name|done
goto|;
block|}
name|state
operator|=
name|sw_usual
expr_stmt|;
if|if
condition|(
name|ch
operator|>
literal|'%'
operator|&&
name|ch
operator|<
literal|0x7f
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|ch
expr_stmt|;
break|break;
block|}
operator|*
name|d
operator|++
operator|=
literal|'%'
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
operator|(
name|s
operator|-
literal|2
operator|)
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
operator|(
name|s
operator|-
literal|1
operator|)
expr_stmt|;
break|break;
block|}
comment|/* skip the invalid quoted character */
break|break;
block|}
block|}
name|done
label|:
operator|*
name|dst
operator|=
name|d
expr_stmt|;
operator|*
name|src
operator|=
name|s
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
operator|(
name|NGX_MEMCPY_LIMIT
operator|)
end_if

begin_function
name|void
modifier|*
DECL|function|ngx_memcpy (void * dst,void * src,size_t n)
name|ngx_memcpy
parameter_list|(
name|void
modifier|*
name|dst
parameter_list|,
name|void
modifier|*
name|src
parameter_list|,
name|size_t
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|>
name|NGX_MEMCPY_LIMIT
condition|)
block|{
name|ngx_log_error
argument_list|(
name|NGX_LOG_ALERT
argument_list|,
name|ngx_cycle
operator|->
name|log
argument_list|,
literal|0
argument_list|,
literal|"memcpy %uz bytes"
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|ngx_debug_point
argument_list|()
expr_stmt|;
block|}
return|return
name|memcpy
argument_list|(
name|dst
argument_list|,
name|src
argument_list|,
name|n
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

